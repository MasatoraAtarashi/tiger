# Tiger CLI - タスク実行の改善

## 実装内容

Tiger CLIがユーザーのリクエストを受け取った後、単一のツール実行で終わるのではなく、タスク全体を完了するまで複数のステップを実行できるように改善しました。

### 主な変更点

1. **実行ループの追加** (`src/tiger.ts`)
   - 最大10回までのイテレーションで、タスクが完了するまでツールを実行
   - 実行履歴を保持し、次のアクションを決定する際の文脈として使用

2. **プロンプトの改善**
   - 実行履歴を含めて、AIが次に何をすべきかを判断できるように
   - プログラミングタスクでは、ファイル作成、実装、テストのステップに分けるよう指示

3. **エラーハンドリングの強化**
   - Ollamaが起動していない場合の分かりやすいエラーメッセージ
   - タイムアウト設定（60秒）

### 使用例

「フィボナッチ数計算するプログラムつくって」というリクエストに対して：

1. `write_file`でfibonacci.pyファイルを作成
2. `run_command`でプログラムをテスト実行
3. 結果を確認して完了報告

### 技術的詳細

- **実行履歴の構造**：
  ```typescript
  interface ExecutionStep {
    tool: string;
    args: any;
    result: any;
  }
  ```

- **ループ内での処理**：
  1. 現在の状態（実行履歴）を含めたプロンプトを生成
  2. Ollamaに次のアクションを問い合わせ
  3. ツールを実行するか、完了メッセージを返すか判断
  4. ツール実行の場合は履歴に追加して次のイテレーション

### 注意事項

- Ollamaが起動していることが前提（`ollama serve`）
- 日本語の処理にはllama3.2:3bモデルを使用
- 無限ループ防止のため最大10イテレーション

### 今後の改善案

1. より賢いタスク分解（専用のプランナーツールの実装）
2. 実行結果の評価と修正機能
3. 並列実行可能なタスクの識別と最適化